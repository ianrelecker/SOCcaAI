id: be6c05d3-7a21-48c5-9a37-9e3772dfe35d
name: SOCca - Critical Vulnerability Detected
description: |
  Detects when SOCca identifies a critical vulnerability (CVSS >= 9.0) with confirmed exploitability
  according to OpenAI analysis.
severity: High
requiredDataConnectors:
  - connectorId: CustomLogs
    dataTypes:
      - SOCca_CL
queryFrequency: PT1H
queryPeriod: PT1H
triggerOperator: gt
triggerThreshold: 0
tactics:
  - InitialAccess
  - Execution
relevantTechniques:
  - T1190
  - T1203
query: |
  SOCca_CL
  | where TimeGenerated > ago(1h)
  | where CVSS_Score_d >= 9.0
  | where AI_Analysis_s contains "exploit" or AI_Analysis_s contains "exploitable"
  | project TimeGenerated, CVE_s, CVSS_Score_d, AI_Analysis_s, Description_s
  | order by CVSS_Score_d desc
entityMappings:
  - entityType: SecurityAlert
    fieldMappings:
      - identifier: AlertId
        columnName: CVE_s
alertDetailsOverride:
  alertDisplayName: SOCca detected critical exploitable vulnerability - {CVE_s}
  alertDescription: |
    SOCca has detected a critical vulnerability (CVSS {CVSS_Score_d}) with confirmed exploitability.
    
    AI Analysis: {AI_Analysis_s}
    
    Description: {Description_s}
version: 1.0.0
kind: Scheduled

---

id: 2a93e7d1-9b7f-4f3e-8c23-f9a87d510830
name: SOCca - Targeted Technology Vulnerability
description: |
  Detects when SOCca identifies vulnerabilities specifically affecting technologies
  in your environment based on keyword matching.
severity: Medium
requiredDataConnectors:
  - connectorId: CustomLogs
    dataTypes:
      - SOCca_CL
queryFrequency: PT1H
queryPeriod: PT1H
triggerOperator: gt
triggerThreshold: 0
tactics:
  - InitialAccess
  - PrivilegeEscalation
relevantTechniques:
  - T1190
  - T1068
query: |
  // Edit this list to include technologies in your environment
  let environmentTech = dynamic(["Windows Server", "Azure", "Office 365", "Exchange", "Active Directory", "SQL Server"]);
  SOCca_CL
  | where TimeGenerated > ago(1h)
  | where CVSS_Score_d >= 7.0
  | mv-expand tech = environmentTech
  | where Description_s has tech or AI_Analysis_s has tech
  | project TimeGenerated, CVE_s, CVSS_Score_d, AI_Analysis_s, Description_s, AffectedTech=tech
  | order by CVSS_Score_d desc
entityMappings:
  - entityType: SecurityAlert
    fieldMappings:
      - identifier: AlertId
        columnName: CVE_s
alertDetailsOverride:
  alertDisplayName: SOCca detected vulnerability affecting {AffectedTech} - {CVE_s}
  alertDescription: |
    SOCca has detected a vulnerability affecting {AffectedTech} with a CVSS score of {CVSS_Score_d}.
    
    AI Analysis: {AI_Analysis_s}
    
    Description: {Description_s}
version: 1.0.0
kind: Scheduled

---

id: 3d147f48-c5e7-4b01-a42c-5a870e7c9abd
name: SOCca - AI Detects Ransomware Related Vulnerability
description: |
  Detects when SOCca's AI analysis identifies vulnerabilities that could be used in ransomware attacks
  or data exfiltration.
severity: High
requiredDataConnectors:
  - connectorId: CustomLogs
    dataTypes:
      - SOCca_CL
queryFrequency: PT3H
queryPeriod: PT3H
triggerOperator: gt
triggerThreshold: 0
tactics:
  - Impact
  - Exfiltration
relevantTechniques:
  - T1486
  - T1489
  - T1567
query: |
  SOCca_CL
  | where TimeGenerated > ago(3h)
  | where AI_Analysis_s has_any("ransomware", "encryption", "data theft", "exfiltration", "wiper", "destructive")
  | project TimeGenerated, CVE_s, CVSS_Score_d, AI_Analysis_s, Description_s
  | order by CVSS_Score_d desc
entityMappings:
  - entityType: SecurityAlert
    fieldMappings:
      - identifier: AlertId
        columnName: CVE_s
alertDetailsOverride:
  alertDisplayName: SOCca detected potential ransomware-related vulnerability - {CVE_s}
  alertDescription: |
    SOCca's AI analysis has identified a vulnerability that could potentially be used in ransomware attacks or data theft operations.
    
    AI Analysis: {AI_Analysis_s}
    
    Description: {Description_s}
    
    CVSS Score: {CVSS_Score_d}
version: 1.0.0
kind: Scheduled